# 功能更新记录

## 2025-01-14 16:50:00
- 创建功能更新记录文件
- 实现LaTeX智能识别功能
  - 创建 `client/src/utils/latexParser.ts` 工具函数
  - 支持解析LaTeX格式的题目、答案、解析
  - 自动提取 `\item`、`\textbf{答案：}`、`\textbf{解析：}` 等标记
  - 支持数学公式 `$...$` 和 `\[...\]` 格式转换
- 更新 `client/src/components/QuestionForm.tsx`
  - 集成LaTeX智能识别功能
  - 添加手动输入和LaTeX识别两种模式切换
  - 集成Markdown编辑器支持数学公式
  - 添加示例加载功能
  - 修复ESLint警告，使用useCallback优化性能
- 更新 `client/src/components/Home.tsx`
  - 修复ESLint警告，使用useCallback优化fetchData函数
  - 恢复仪表盘界面内容

## 2025-08-15 00:51:42
- 前端服务器成功启动
- 验证LaTeX智能识别功能已集成到QuestionForm组件
- 确认仪表盘界面已恢复并正常显示
- 系统已准备好测试LaTeX解析功能

## 2025-08-15 00:53:03
- 简化QuestionForm组件，移除题目标题字段
- 优化表单布局，将年级、知识点、题目类型调整为3列布局
- 难度等级单独一行显示
- 简化LaTeX解析逻辑，不再处理title字段
- 提升用户体验，减少不必要的输入项

## 2025-08-15 00:56:26
- 更新类型定义，添加自定义标签支持 (custom_tags: string[])
- 更新QuestionForm组件，添加自定义标签功能
  - 支持输入框输入并按回车添加标签
  - 标签显示为蓝色圆角标签
  - 支持点击X按钮删除标签
- 开始开发QuestionList组件，参考提供的UI设计
  - 计划实现搜索、筛选、标签系统和查看答案功能
  - 包含年级、类型、难度、知识点筛选
  - 支持点击查看/隐藏答案
  - 显示自定义标签

## 2025-08-15 01:11:47
- 完成QuestionList组件的开发
  - 实现完整的搜索和筛选功能（年级、类型、难度、知识点）
  - 添加查看/隐藏答案功能，点击按钮可展开答案和解析
  - 显示自定义标签系统，支持标签筛选
  - 实现题目删除功能
  - 参考提供的UI设计，包含统计信息显示
  - 支持空状态显示和引导用户添加题目
- 前端服务器成功启动，所有功能已集成
- 系统已准备好测试题目管理功能

## 2025-08-15 01:12:19
- 修复Layout组件UI问题
  - 将"数学题库"标题和图标移到侧边栏左上角
  - 移除顶部导航栏，简化布局结构
- 优化QuestionList组件
  - 将查看答案按钮移到操作区域，与编辑、删除按钮并排
  - 移除按钮文字，只保留图标，提升界面简洁性
  - 添加Markdown和LaTeX渲染支持
  - 使用ReactMarkdown组件正确显示数学公式
  - 添加react-katex类型声明文件
- 更新store，添加removeQuestion方法
- 修复TypeScript类型错误

## 2025-08-15 01:25:48
- 修复编译错误和类型问题
  - 修复PaperList组件中的类型错误，移除不存在的type和question_count属性
  - 安装@tailwindcss/typography插件，支持prose样式
  - 创建remark-math和rehype-katex的类型声明文件
  - 简化ReactMarkdown配置，移除自定义components
  - 确保LaTeX数学公式正确渲染
- 前端服务器成功启动，所有编译错误已修复

## 2025-08-15 01:32:20
- 启动后端服务器，确保数据API正常工作
- 在QuestionList组件中添加LaTeX渲染测试区域
  - 包含完整的数学公式测试用例
  - 验证remark-math和rehype-katex插件是否正常工作
  - 测试行内公式($...$)和块级公式(\[...\])渲染
- 检查数据库内容，确认题目数据存储格式
- 前端和后端服务器均已启动，准备测试LaTeX渲染功能

## 2025-08-15 01:36:14
- 修复题目编辑功能
  - 创建QuestionEdit组件，支持编辑现有题目
  - 添加编辑路由 `/questions/edit/:id` 到App.tsx
  - 在store中添加updateQuestion方法
  - 在API中添加update方法
  - 在后端添加PUT `/api/questions/:id` 路由
  - 支持LaTeX智能识别和自定义标签功能
  - 编辑页面包含完整的表单验证和错误处理
- 前端服务器成功启动，编辑功能已可用

## 2025-08-15 01:52:08
- 大幅改进LaTeX渲染支持
  - 创建专门的LaTeX渲染工具 `latexRenderer.ts`
  - 支持多种LaTeX公式格式：
    - 行内公式：`$...$` 和 `\(...\)`
    - 块级公式：`$$...$$` 和 `\[...\]`
    - 方括号格式：`[ ... ]`
    - equation和align环境
  - 添加预处理功能，自动转换不同格式
  - 改进错误处理，显示渲染错误信息
  - 更新QuestionList组件使用新的渲染工具
  - 在测试区域添加多种格式的LaTeX公式测试
- 现在支持您提到的 `[ x = \frac{5 \pm \sqrt{(-5)^2 - 4 \times 2 \times 3}}{2 \times 2} = \frac{5 \pm 1}{4} ]` 格式

## 2025-08-15 02:14:43
- 修复转义美元符号格式的LaTeX渲染
  - 添加对 `\$...\$` 格式的支持
  - 自动转换为标准的 `$$...$$` 块级公式格式
  - 在测试区域添加转义美元符号格式的测试用例
  - 现在支持 `\$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}\$` 格式

## 2025-08-15 02:19:06
- 修复LaTeX渲染顺序问题
  - 调整渲染顺序：先处理块级公式 `$$...$$`，再处理行内公式 `$...$`
  - 避免预处理后的块级公式被行内公式正则表达式误匹配
  - 确保转义美元符号格式 `\$...\$` 能正确渲染为块级公式

## 2025-08-15 02:41:36
- 改进转义美元符号格式的LaTeX渲染
  - 优化正则表达式 `/\\\$(.*?)\\\$/g` 以更准确地匹配转义美元符号
  - 添加高斯公式测试区域，包含多种格式：
    - 标准行内格式：`$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$`
    - 标准块级格式：`$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$`
    - 转义格式：`\\$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}\\$`
  - 现在应该能正确渲染高斯公式 `\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}`

## 2025-08-15 02:44:33
- 修复LaTeX公式解析错误
  - 解决KaTeX解析错误："Unexpected character: '\' at position 50"
  - 在预处理阶段移除公式末尾的多余反斜杠
  - 在渲染阶段添加公式清理逻辑：
    - 移除末尾的反斜杠：`.replace(/\\$/, '')`
    - 移除开头的反斜杠：`.replace(/^\\/, '')`
  - 添加"完美公式测试"区域，包含积分、求和、极限等常用数学公式
  - 确保所有LaTeX公式都能完美渲染，不再出现解析错误

## 2025-08-15 02:49:32
- 扩展LaTeX渲染支持，添加文本命令处理
  - 新增 `renderLatexText` 函数处理LaTeX文本命令
  - 支持的命令包括：
    - `\item` → 转换为项目符号 "• "
    - `\textbf{...}` → 转换为HTML粗体 `<strong>...</strong>`
    - `\textit{...}` → 转换为HTML斜体 `<em>...</em>`
    - `\underline{...}` → 转换为HTML下划线 `<u>...</u>`
    - `\sqrt{...}` → 转换为根号符号 "√..."
    - `\frac{...}{...}` → 转换为分数形式 ".../..."
  - 在 `renderMarkdownWithLatex` 中集成文本命令处理
  - 添加"LaTeX文本命令测试"区域验证功能
  - 解决 `\item`、`\textbf`、`/sqrt(1)` 等命令显示为代码的问题

## 2025-08-15 02:52:52
- 添加完整的Markdown语法支持
  - 新增 `renderMarkdown` 函数处理Markdown语法
  - 支持的Markdown语法包括：
    - **粗体**：`**文本**` → `<strong>文本</strong>`
    - *斜体*：`*文本*` → `<em>文本</em>`
    - ~~删除线~~：`~~文本~~` → `<del>文本</del>`
    - `行内代码`：`` `代码` `` → `<code>代码</code>`
    - 标题：`# 标题` → `<h1>标题</h1>`
    - 列表：`- 项目` → `<li>项目</li>`
    - 链接：`[文本](链接)` → `<a href="链接">文本</a>`
  - 在 `renderMarkdownWithLatex` 中集成Markdown处理
  - 添加"Markdown语法测试"区域验证功能
  - 现在系统同时支持LaTeX和Markdown语法，提供更丰富的文本格式化选项

## 2025-08-15 02:56:03
- 修复LaTeX文本命令处理错误
  - 移除在文本环境中错误处理数学命令的逻辑
  - 删除 `\sqrt{...}` 和 `\frac{...}{...}` 在文本环境中的转换
  - 确保数学命令（如 `\int`、`\sqrt`、`\frac`）只在数学环境内使用
  - 修正LaTeX语法规范，避免将数学命令错误地转换为文本符号
  - 现在 `\int` 等数学命令只在 `$...$` 或 `$$...$$` 环境中被正确渲染

## 2025-08-15 02:58:51
- 修复LaTeX渲染器空值错误
  - 在所有渲染函数中添加输入验证，防止 `undefined` 或 `null` 值导致错误
  - 修复 `Cannot read properties of undefined (reading 'replace')` 错误
  - 添加安全检查：`if (!content || typeof content !== 'string') return '';`
  - 确保在编辑题目后不会因为空内容导致渲染错误
  - 提高系统稳定性，防止因数据不完整导致的崩溃

## 2025-08-15 03:01:30
- 进一步加固空值处理
  - 在QuestionList组件中添加空值保护：`question.content || ''`
  - 在答案和解析渲染中也添加空值保护：`question.answer || ''` 和 `question.analysis || ''`
  - 确保即使数据库中的字段为空也不会导致渲染错误
  - 双重保护：组件层面和渲染函数层面都有空值检查

## 2025-08-15 03:07:12
- 添加删除题目功能
  - 在后端添加 `DELETE /api/questions/:id` 端点
  - 实现级联删除：先删除试卷题目关联，再删除题目本身
  - 确保删除操作的数据完整性

## 2025-08-15 03:17:19
- 修复LaTeX数学符号渲染错误
  - 移除错误的反斜杠清理逻辑：`cleanFormula.replace(/^\\/, '')`
  - 修复积分符号 `\int` 显示为 "int" 的问题
  - 修复求和符号 `\sum` 显示为 "sum" 的问题
  - 现在 `\int_{-\infty}^{\infty}` 正确渲染为 ∫ 符号
  - 现在 `\sum_{n=1}^{\infty}` 正确渲染为 ∑ 符号

## 2025-08-15 03:22:46
- 大幅扩展Markdown语法支持
  - 新增标题支持：1-6级标题 (`#` 到 `######`)
  - 新增粗体格式：`**文本**` 和 `__文本__`
  - 新增斜体格式：`*文本*` 和 `_文本_`
  - 新增代码块：\`\`\`代码块\`\`\`
  - 新增引用块：`> 引用文本`
  - 新增有序列表：`1. 项目`
  - 新增无序列表：`- 项目` 和 `* 项目`
  - 新增图片：`![alt](链接)`
  - 新增水平分割线：`---` 和 `***`
  - 新增换行：两个空格 + 换行
  - 新增段落处理：空行分隔
  - 更新测试区域，包含所有新增的Markdown语法示例

## 2025-08-15 03:25:12
- 修复Markdown与LaTeX冲突问题
  - 实现LaTeX公式保护机制：使用占位符临时替换LaTeX公式
  - 确保Markdown处理不会干扰LaTeX渲染
  - 处理流程：LaTeX渲染 → 占位符替换 → Markdown处理 → LaTeX恢复
  - 现在可以同时使用Markdown和LaTeX语法，互不干扰
  - 支持混合内容：Markdown格式 + LaTeX数学公式

## 2025-08-15 03:27:21
- 紧急修复LaTeX公式丢失问题
  - 回退到简单的渲染流程：LaTeX → Markdown
  - 简化Markdown语法支持，避免与LaTeX冲突
  - 移除复杂的占位符机制，恢复LaTeX公式正常显示
  - 保留基本的Markdown功能：标题、粗体、斜体、列表、链接等
  - 确保LaTeX数学公式优先渲染，不被Markdown干扰

## 2025-08-15 03:35:00
- 为题目列表添加时间显示功能
  - 数据库表结构更新：添加 `updated_at` 字段
  - 后端API更新：编辑题目时自动更新 `updated_at` 时间戳
  - 前端界面更新：在题目列表中添加创建时间和修改时间显示
  - 时间格式：使用中文本地化格式 `toLocaleString('zh-CN')`
  - 显示位置：在题目信息行下方，使用小字体灰色显示
  - 现有数据兼容：为现有题目设置 `updated_at = created_at`

## 2025-08-15 04:02:31
- 修复时区和LaTeX解析问题
  - 数据库时区修复：使用 `datetime('now', 'localtime')` 替代 `CURRENT_TIMESTAMP`
  - 设置SQLite时区为 `Asia/Shanghai`，解决8小时时差问题
  - 修复LaTeX智能识别：正确处理 `\begin{enumerate}` 和 `\end{enumerate}` 环境
  - 避免将LaTeX环境标记包含在解析内容中
  - 确保多题目环境中的内容正确分离

## 2025-08-15 04:06:52
- 添加服务器管理功能
  - 新增管理面板页面：`/admin` 路由
  - 实时显示前后端服务器状态（运行中/已停止）
  - 添加重启后端服务器功能（通过API调用）
  - 添加重启前端服务器功能（提示手动操作）
  - 添加一键重启所有服务功能
  - 创建重启脚本 `restart.sh` 用于手动重启
  - 在侧边栏导航中添加"服务器管理"链接
  - 提供手动重启说明和命令提示

## 2025-08-15 04:08:15
- 修复LaTeX行内公式渲染问题
  - 修复行内公式正则表达式：移除 `\n` 限制，允许公式包含换行符
  - 从 `/\$([^\$\n]+?)\$/g` 改为 `/\$([^\$]+?)\$/g`
  - 解决复杂公式如 `$ \int \sin x \, dx = -\cos x + C $` 无法正确渲染的问题
  - 添加用户问题测试用例到LaTeX测试区域
  - 确保包含空格和换行的LaTeX公式能够正确识别和渲染

## 2025-08-15 04:16:26
- 实现题目ID自动生成系统
  - 数据库表结构更新：添加 `question_id` 字段（12位数字）
  - 题目ID格式：前8位（年月日）+ 后4位（当日序号）
  - 示例：202508150001（2025年8月15日第1题）
  - 移除题目管理页面的题目标题显示
  - 在题目列表顶部显示题目ID
  - 在时间信息行添加题目ID显示
  - 新增题目时自动生成题目ID
  - 添加API为现有题目生成题目ID
  - 在管理面板添加"生成题目ID"按钮
  - 支持为历史题目按创建时间顺序生成ID

## 2025-08-15 04:21:51
- 修复时区问题并优化题目显示
  - 修复题目ID生成使用东八区时间（UTC+8）
  - 修复前端时间显示使用东八区时间
  - 完全移除题目管理页面的题目标题显示
  - 在题目ID下方添加题目标签显示区域
  - 标签包括：年级（蓝色）、知识点（绿色）、题目类型（紫色）、自定义标签（橙色）
  - 优化标签显示样式，使用不同颜色区分不同类型
  - 确保所有时间相关功能都使用东八区时间
  - 重新生成所有题目的ID，确保时间正确

## 2025-08-15 04:30:29
- 修复数据库时间存储和修改时间逻辑
  - 修复数据库表创建语句：使用 `datetime('now', '+8 hours')` 存储东八区时间
  - 修复创建题目API：手动计算并存储东八区时间字符串
  - 修复更新题目API：修改时自动更新为当前东八区时间
  - 简化时间转换逻辑：直接使用 `new Date(now.getTime() + (8 * 3600000))`
  - 确保创建时间和修改时间都存储为东八区时间
  - 验证修改时间逻辑：编辑题目时 `updated_at` 自动更新为当前时间
  - 移除前端时区转换：数据库已存储东八区时间，直接显示即可

## 2025-08-15 04:34:38
- 修复题目ID唯一性问题
  - 修复题目ID生成逻辑：添加重复ID检查和自动递增机制
  - 实现ID冲突检测：检查生成的ID是否已存在
  - 添加自动查找下一个可用ID的逻辑
  - 重新生成所有题目ID，确保唯一性
  - 验证新创建题目的ID唯一性

## 2025-08-15 04:36:50
- 优化题目管理界面布局
  - 移除第一行的题目ID和难度显示
  - 将难度标签移到第二行标签的最后面
  - 将使用次数从第三行移到时间信息行的最后面
  - 优化整体布局，使界面更加紧凑
  - 保持所有功能不变，仅调整显示位置

## 2025-08-15 04:39:02
- 进一步简化题目管理界面
  - 删除第二行的年级、类型、知识点文本信息
  - 保留操作按钮（查看、编辑、删除）并右对齐
  - 界面更加简洁，信息层次更清晰
  - 标签已包含所有必要信息，无需重复显示文本

## 2025-08-15 04:41:31
- 优化题目管理界面布局
  - 将操作按钮移到标签行的右边，减少空行
  - 使用 `justify-between` 布局，标签在左，按钮在右
  - 隐藏LaTeX测试区域，简化界面
  - 界面更加紧凑，减少不必要的空白区域

## 2025-08-15 04:48:51
- 完善自定义标签功能
  - 后端数据库添加 `custom_tags` 字段，支持JSON存储
  - 修复POST和PUT API，正确处理自定义标签的保存和更新
  - 修复GET API，正确解析和返回自定义标签数组
  - 前端标签显示支持点击筛选功能
  - 添加自定义标签筛选输入框和清除筛选按钮
  - 所有标签（年级、知识点、类型、难度、自定义标签）都支持点击筛选
  - 标签点击时高亮显示，再次点击取消筛选

## 2025-08-15 04:58:17
- 添加自定义标签统计显示功能
  - 在搜索题目行上方显示自定义标签统计区域
  - 按标签出现次数降序排序显示
  - 显示每个标签的使用次数
  - 支持点击标签进行筛选，选中状态高亮显示
  - 使用相对布局，避免标签过多时UI混乱
  - 添加提示文字说明点击功能
  - 标签统计区域只在有自定义标签时显示

## 2025-08-15 05:04:26
- 优化标签统计显示和自定义标签管理
  - 将标签统计区域分为4行：自定义标签、年级、难度、题目类型
  - 每行标签按出现次数降序排序，显示使用次数
  - 所有标签都支持点击筛选，选中状态高亮显示
  - 不同类别标签使用不同颜色区分（橙色、蓝色、绿色、紫色）
  - 在新增和编辑题目时，添加重复自定义标签会提示"请勿重复添加"
  - 优化标签统计计算逻辑，统一处理所有类型标签
  - 标签统计区域只在有标签数据时显示

## 2025-08-15 05:10:28
- 统一知识点和自定义标签系统
  - 后端API修改：将知识点合并到自定义标签中
  - 添加数据迁移API：将现有题目的知识点迁移到自定义标签
  - 前端类型定义更新：移除knowledge_point字段
  - 搜索栏优化：删除自定义标签输入框，将知识点改为复选框
  - 复选框选项：显示所有自定义标签内容
  - 支持多选筛选：可以选择多个自定义标签进行筛选
  - 表单优化：移除知识点选择框，统一使用自定义标签
  - 标签显示优化：移除知识点标签显示，统一显示为自定义标签

## 2025-08-15 05:14:45
- 优化服务器管理面板的重启功能
  - 添加自动状态检测：每10秒自动检查服务器状态
  - 改进重启逻辑：支持后端离线时的重启机制
  - 添加状态监控区域：显示最后检查时间和自动检测状态
  - 实现智能重启：先尝试API重启，失败后提供系统级重启指导
  - 添加重启指导窗口：当自动重启失败时，打开新窗口显示手动重启命令
  - 添加服务器状态API：提供服务器运行状态和运行时间信息
  - 优化用户体验：提供更详细的重启反馈和指导信息

## 2025-08-15 05:17:41
- 修复知识点字段移除后的编译错误
  - 修复ManualPaper组件：将知识点显示改为自定义标签显示
  - 修复QuestionEdit组件：移除知识点选择框和LaTeX解析中的知识点处理
  - 修复AutoPaper组件：将知识点选择框改为自定义标签输入框
  - 修复latexParser.ts：移除知识点解析逻辑
  - 修复types/index.ts：更新AutoPaperFormData接口，将knowledge_point改为custom_tags
  - 完成所有知识点字段的清理工作，确保代码编译通过

## 2025-08-15 05:19:44
- 修复后端服务器启动失败问题
  - 问题原因：数据库中存在重复的custom_tags列，导致ALTER TABLE语句失败
  - 解决方案：添加错误处理逻辑，当列已存在时跳过添加操作
  - 修复效果：后端服务器成功启动，API正常运行
  - 验证结果：服务器状态API返回正常响应

## 2025-08-15 05:24:38
- 实现图片识别功能（基础版本）
  - 创建ImageUpload组件：支持图片上传、预览和OCR识别
  - 修改QuestionForm组件：添加图片识别输入模式
  - 添加OCR API接口：提供图片识别服务（目前为模拟数据）
  - 支持三种输入模式：手动输入、LaTeX识别、图片识别
  - 图片识别流程：上传图片 → 预览 → 识别 → 结果填入表单
  - 用户体验优化：加载动画、错误处理、使用说明

## 2025-08-15 05:31:26
- 实现免费OCR识别功能
  - 集成Tesseract.js：完全免费的OCR库，支持中文+英文识别
  - 添加图片预处理功能：自动增强对比度，提高识别准确率
  - 改进智能解析算法：自动识别题目、答案、解析部分
  - 支持多种识别模式：选择题选项、序号、关键词识别
  - 优化用户体验：实时识别进度、错误处理、详细使用说明
  - 技术特点：纯前端实现，无需服务器资源，完全免费

## 2025-08-15 05:34:28
- 优化搜索栏UI设计
  - 将"知识点/自定义标签"从复选框改为下拉选择形式
  - 保持选择范围与之前一致（所有自定义标签）
  - 简化筛选逻辑，移除多选功能，改为单选
  - 更新清除筛选按钮逻辑，移除多选相关代码
  - 优化用户体验，使界面更加简洁统一

## 2025-08-15 05:47:17
- 优化侧边栏标题样式
  - 将"数学题库"标题区域改为蓝底白字设计
  - 调整图标背景为半透明白色，保持视觉层次
  - 移除底部边框，使用蓝色背景替代
  - 提升品牌识别度和视觉美观度

## 2025-08-15 05:49:51
- 全面优化侧边栏设计美感
  - 标题区域改为居中布局，增加英文副标题
  - 图标尺寸增大，使用圆角设计，提升视觉层次
  - 导航项选中状态优化：浅蓝背景、左侧蓝色边框、阴影效果
  - 增加过渡动画效果，提升交互体验
  - 调整间距和阴影，增强整体视觉层次感
  - 图标颜色动态变化，选中时蓝色，未选中时灰色

## 2025-08-15 05:57:30
- 优化整体布局和背景设计
  - 主内容区域：添加浅灰色背景和内边距，营造层次感
  - 内容模块：搜索框、题目列表、标签统计等使用白色背景和轻微阴影
  - 左侧边栏：导航区域使用白色背景，与标题区域宽度保持一致
  - 移除主内容区域的默认内边距，让各页面自行控制间距
  - 整体视觉效果：白色内容模块在浅灰色背景上，层次分明

## 2025-08-15 05:58:48
- 优化欢迎页面设计
  - 欢迎信息区域：从蓝色渐变背景改为白色背景
  - 标题文字：从白色改为深灰色，保持清晰可读
  - 副标题文字：从浅蓝色改为中灰色，与整体设计保持一致
  - 添加轻微阴影效果，与其他内容模块保持视觉统一

## 2025-08-15 06:00:36
- 降低系统整体颜色饱和度，提升视觉舒适度
  - 首页快速操作模块：从600/700系列改为400/500系列，颜色更柔和
  - 统计卡片图标：从500系列改为400系列，降低饱和度
  - 左侧边栏标题区域：从blue-600改为blue-500，更加柔和
  - 整体视觉效果：颜色更加温和，减少视觉疲劳，提升用户体验

## 2025-08-15 06:01:59
- 优化首页卡片式布局设计
  - 整体背景：添加浅灰色背景和内边距，营造层次感
  - 欢迎信息：白色背景卡片，轻微阴影效果
  - 统计卡片：统一白色背景，轻微阴影，悬停时阴影加深
  - 快速操作：整体包装为白色背景卡片，内部保持彩色按钮
  - 视觉效果：每个模块像独立卡片悬浮在浅灰色背景上

## 2025-08-15 06:03:46
- 优化左侧导航栏颜色区分
  - 导航栏背景：使用浅灰色（gray-200），与右侧内容区域形成明显区分
  - 导航项文字：深灰色（gray-700），在浅灰背景上清晰可读
  - 选中状态：蓝色背景（blue-500）+ 白色文字，突出显示
  - 悬停效果：浅灰背景（gray-300）+ 深灰文字，提供良好交互反馈
  - 整体效果：左侧导航栏与右侧内容区域颜色对比明显，层次分明

## 2025-08-15 06:07:39
- 统一所有页面布局和对齐方式
  - 主内容区域：统一添加浅灰色背景（gray-50）和内边距（p-6）
  - 页面标题：所有页面标题统一为白色背景卡片，位置一致
  - 标题样式：统一使用2xl字体、深灰色文字、图标+文字布局
  - 内容模块：统一使用白色背景卡片，轻微阴影效果
  - 整体效果：所有页面标题位置一致，对齐方式统一，浅灰色背景清晰可见

## 2025-08-15 06:13:05
- 修复布局问题，优化对齐和背景显示
  - 主内容区域：改为更深的灰色背景（gray-100）和更大的内边距（p-8）
  - 统一容器：在Layout中统一设置max-width容器，所有页面使用相同宽度
  - 移除重复：移除各页面中的max-width设置，避免宽度不一致
  - 背景可见：更深的灰色背景现在在白色卡片之间清晰可见
  - 对齐统一：所有页面内容都使用相同的容器宽度，对齐方式一致

## 2025-08-15 06:19:34
- 实现智能组卷和人工组卷功能
  - 智能组卷：根据年级、知识点、题目类型、难度等条件自动筛选题目
  - 智能算法：随机选择指定数量的题目，确保题目分布合理
  - 人工组卷：支持手动选择题目，实时预览已选题目
  - 题目筛选：支持多条件组合筛选，包括自定义标签匹配
  - 试卷创建：自动创建试卷并保存到数据库
  - 用户体验：添加加载状态、成功提示、错误处理
  - 布局优化：统一页面标题和内容区域布局，符合设计规范

## 2025-08-15 13:06:10
- 组卷功能完善与导出支持
  - 智能组卷：新增“知识点/自定义标签”下拉按钮组件，支持多选勾选，结合年级/题型/难度/数量进行筛选与随机抽题
  - 人工组卷：在题目列表上方新增筛选栏（年级、题型、难度、知识点/标签），便于快速定位题目
  - 试卷预览：新增 `'/papers/:id'` 详情页，显示试卷标题、描述与题目清单
  - 导出功能：支持一键导出 PDF（html2pdf.js）与 DOCX（docx + file-saver）
  - 列表优化：`PaperList` 卡片显示题目数量并提供“预览”入口
  - 依赖：前端新增 `docx`、`file-saver`、`html2pdf.js` 及类型声明

## 2025-08-15 14:30:22
- 组卷体验与排版优化（人工组卷标签云 + 预览渲染/导出格式）
  - 人工组卷：在筛选上方增加与题目管理一致的标签云（自定义标签、年级、难度、题型），可点击筛选/反选
  - 预览界面：使用 Markdown + LaTeX 渲染（KaTeX），结构化显示题干、答案、解析，排版更接近常见试卷样式
  - PDF 导出：基于 html2pdf.js，按预览渲染效果导出，支持公式
  - DOCX 导出：改为按渲染内容导出（截图嵌入或文本结构），避免LaTeX源码外泄
  - 依赖：新增 html2canvas 用于导出截图渲染

## 2025-08-15 15:08:40
- 打包与部署能力
  - 前端 API 基址可配置：支持 `REACT_APP_API_BASE_URL`，默认同源 `/api`
  - 后端统一托管：生产环境静态托管 `client/build`，并提供前端路由回退（单页应用）
  - 根脚本：新增 `npm start`（生产服务）与 `npm run build:prod`（一键安装+构建）
  - README：新增“生产环境构建（同一进程托管前后端）”指引

## 2025-08-16 23:07:56
- 人工组卷与预览修复
  - 人工组卷：题目列表与已选预览启用 Markdown + LaTeX 渲染（不再显示源码）
  - 试卷预览：添加加载失败提示，帮助定位 404（服务器未运行或试卷不存在）
  - API Base：开发环境固定走 http://localhost:3001/api，生产同源 /api，避免跨域与 404

## 2025-08-17 00:28:55 (v1.1.0)
- 试卷标题默认规则与编号
  - 新增 `papers.teacher`、`papers.serial_no` 字段；创建试卷时按教师与当日计算序号
  - 当未填写标题时，后端自动生成：`{教师名}{YYYYMMDD}数学试卷 #序号`
  - 仅成功创建计入当日序号；失败不占用编号
  - 前端在人工/智能组卷创建请求中附带 `teacher` 字段（当前默认“独立老师”）

## 2025-08-17 10:25:00 (v1.1.1)
- 新增题目：图片识别体验改进
  - OCR 识别完成后不再自动切换到"手动输入"，仍停留在"图片识别"界面
  - 保留图片预览与识别文本，直到用户手动点击"重新上传/清除"为止
  - 释放对象URL（Object URL）以避免内存泄漏
  - 清理未使用的图标导入
  - 受影响文件：
    - `client/src/components/ImageUpload.tsx`
    - `client/src/components/QuestionForm.tsx`

## 2025-08-17 18:30:00 (v1.2.0)
- 数学公式OCR功能重大升级
  - **新增API管理模块**：左侧导航新增"API管理"页面，支持用户自定义配置OCR API
  - **多API支持**：集成Mathpix、腾讯云、百度、阿里云、讯飞等专业数学公式识别API
  - **智能回退策略**：按优先级调用API，失败时自动尝试下一个，最终回退到本地Tesseract
  - **LaTeX输出**：专业API支持直接输出LaTeX格式，提升数学公式处理能力
  - **使用量监控**：显示每个API的月使用量和限额，避免超量调用
  - **API测试功能**：支持测试API配置的连通性和有效性
  - **双模式切换**：图片识别界面支持"数学公式OCR"和"基础OCR"模式切换
  - **详细识别信息**：显示使用的API、置信度、LaTeX结果等详细信息
  - 新增文件：
    - `client/src/components/ApiManagement.tsx` - API管理界面
    - `client/src/services/mathOcrApi.ts` - 数学OCR服务核心
  - 更新文件：
    - `client/src/components/ImageUpload.tsx` - 集成新OCR服务
    - `client/src/components/Layout.tsx` - 添加API管理导航
    - `client/src/App.tsx` - 添加API管理路由

## 2025-08-17 19:45:00 (v1.2.1)
- 修复讯飞API认证问题
  - **签名算法修复**：添加了正确的SHA256 digest计算，修复"The string did not match the expected pattern"错误
  - **认证参数说明**：明确讯飞API需要AppID(API Key)和APISecret两个参数
  - **错误处理优化**：针对常见错误码(10163/10160)提供具体错误提示
  - **业务参数调整**：使用正确的业务类型'teach-photo-print'和'raw'格式
  - **请求头完善**：添加Digest头，符合讯飞API v2规范
  - **调试信息增强**：添加详细的请求日志便于排查问题
  - 更新文件：
    - `server/index.js` - 修复讯飞API代理实现
    - `client/src/components/ApiManagement.tsx` - 更新讯飞API说明

## 2025-08-17 20:15:00 (v1.2.2)
- 完善讯飞API三参数支持
  - **前端表单增强**：为讯飞API添加独立的AppID字段，现在支持三个必需参数
  - **参数字段调整**：AppID、API Key、API Secret三个字段清晰分离
  - **表单验证完善**：确保讯飞API的三个参数都必须填写
  - **后端接口更新**：修正讯飞API调用使用正确的AppID参数
  - **接口类型扩展**：在ApiConfig接口中添加appId字段支持
  - **错误提示优化**：明确提示讯飞API需要三个参数配置
  - 更新文件：
    - `client/src/components/ApiManagement.tsx` - 添加AppID字段和验证
    - `client/src/services/mathOcrApi.ts` - 更新接口和调用参数
    - `server/index.js` - 修正AppID参数使用
